apps:
  - script: './index.js'
    args: '--project tsconfig.server.json ./index.ts'
    name: main
    instances: 1
    max_memory_restart: 500M
    error_file: logs/index.log
    out_file: logs/index.log
    kill_timeout: 20000
    exec_mode: cluster
    env:
      NODE_ENV: production
      DEBUG: 'bp:*'
      PORT: 5400
      FIREBASE_READ_KEY: modules-v3
      FIREBASE_WRITE_KEY: modules-v3
      FIREBASE_READ_KEY_EXPORTS: exports-v3
      FIREBASE_WRITE_KEY_EXPORTS: exports-v3
      CACHE_SERVICE_ENDPOINT: http://localhost:7001
      BUILD_SERVICE_ENDPOINT: http://localhost:7002

  - script: ./build-service/index.js
    name: build-service
    instances: 3
    max_memory_restart: 1000M
    exec_mode: cluster
    error_file: logs/build-service.log
    out_file: logs/build-service.log
    kill_timeout: 20000
    env:
      NODE_ENV: production
      DEBUG: 'bp:*'

  - script: ./cache-service/index.js
    name: cache-service
    instances: 1
    max_memory_restart: 200M
    exec_mode: cluster
    kill_timeout: 5000
    error_file: logs/cache-service.log
    out_file: logs/cache-service.log
    env:
      NODE_ENV: production
      DEBUG: 'bp:*'
      FIREBASE_READ_KEY: modules-v3
      FIREBASE_WRITE_KEY: modules-v3
      FIREBASE_READ_KEY_EXPORTS: exports-v3
      FIREBASE_WRITE_KEY_EXPORTS: exports-v3
